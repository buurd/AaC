--- Starting Fix v2 for 503 Errors ---
1. Applying fixed Loki Configuration...
configmap/grafana-datasources unchanged
configmap/loki-config configured
deployment.apps/loki unchanged
service/loki unchanged
serviceaccount/promtail-sa unchanged
daemonset.apps/promtail unchanged
configmap/promtail-config unchanged
clusterrole.rbac.authorization.k8s.io/promtail-clusterrole unchanged
clusterrolebinding.rbac.authorization.k8s.io/promtail-clusterrolebinding unchanged
deployment.apps/grafana unchanged
service/grafana unchanged
ingress.networking.k8s.io/grafana-ingress unchanged
deployment.apps/loki restarted

2. Resetting Webshop and Product Management Databases (Aggressive)...
   Scaling down applications...
deployment.apps/webshop scaled
deployment.apps/product-management scaled
   Scaling down databases...
deployment.apps/webshop-db scaled
deployment.apps/pm-db scaled
   Waiting for pods to terminate...
pod/webshop-db-74885b88df-8sfz4 condition met
   Deleting PVCs...
persistentvolumeclaim "webshop-db-pvc" deleted from webshop namespace
persistentvolumeclaim "pm-db-pvc" deleted from product-management namespace
   Deleting local database data...
   Re-applying PV/PVC definitions...
persistentvolume/webshop-db-pv unchanged
persistentvolumeclaim/webshop-db-pvc created
persistentvolume/pm-db-pv unchanged
persistentvolumeclaim/pm-db-pvc created
persistentvolume/warehouse-db-pv unchanged
persistentvolumeclaim/warehouse-db-pvc unchanged
persistentvolume/order-db-pv unchanged
persistentvolumeclaim/order-db-pvc unchanged
   Scaling databases back up...
deployment.apps/webshop-db scaled
deployment.apps/pm-db scaled
   Waiting for databases to be ready...
--- Starting Fix v2 for 503 Errors ---
1. Applying fixed Loki Configuration...
configmap/grafana-datasources unchanged
configmap/loki-config unchanged
deployment.apps/loki unchanged
service/loki unchanged
serviceaccount/promtail-sa unchanged
daemonset.apps/promtail unchanged
configmap/promtail-config unchanged
clusterrole.rbac.authorization.k8s.io/promtail-clusterrole unchanged
clusterrolebinding.rbac.authorization.k8s.io/promtail-clusterrolebinding unchanged
deployment.apps/grafana unchanged
service/grafana unchanged
ingress.networking.k8s.io/grafana-ingress unchanged
deployment.apps/loki restarted

2. Resetting Webshop and Product Management Databases (Aggressive)...
   Scaling down applications...
deployment.apps/webshop scaled
deployment.apps/product-management scaled
   Scaling down databases...
deployment.apps/webshop-db scaled
deployment.apps/pm-db scaled
   Waiting for pods to terminate...
   Deleting PVCs...
persistentvolumeclaim "webshop-db-pvc" deleted from webshop namespace
persistentvolumeclaim "pm-db-pvc" deleted from product-management namespace
   Deleting local database data...
error: timed out waiting for the condition on pods/webshop-db-74885b88df-j69wt
error: no matching resources found
   Waiting 15s for Postgres initialization...
   Scaling applications back up...
deployment.apps/webshop scaled
deployment.apps/product-management scaled

--- Fix v2 Complete ---
Please wait a few moments for the applications to start, then run ./debug-endpoints.sh to verify.
   Re-applying PV/PVC definitions...
persistentvolume/webshop-db-pv unchanged
persistentvolumeclaim/webshop-db-pvc created
persistentvolume/pm-db-pv unchanged
persistentvolumeclaim/pm-db-pvc created
persistentvolume/warehouse-db-pv unchanged
persistentvolumeclaim/warehouse-db-pvc unchanged
persistentvolume/order-db-pv unchanged
persistentvolumeclaim/order-db-pvc unchanged
   Scaling databases back up...
deployment.apps/webshop-db scaled
deployment.apps/pm-db scaled
   Waiting for databases to be ready...
--- Starting Fix v2 for 503 Errors ---
1. Applying fixed Loki Configuration...
configmap/grafana-datasources unchanged
configmap/loki-config unchanged
deployment.apps/loki unchanged
service/loki unchanged
serviceaccount/promtail-sa unchanged
daemonset.apps/promtail unchanged
configmap/promtail-config unchanged
clusterrole.rbac.authorization.k8s.io/promtail-clusterrole unchanged
clusterrolebinding.rbac.authorization.k8s.io/promtail-clusterrolebinding unchanged
deployment.apps/grafana unchanged
service/grafana unchanged
ingress.networking.k8s.io/grafana-ingress unchanged
deployment.apps/loki restarted

2. Resetting Webshop and Product Management Databases (Aggressive)...
   Scaling down applications...
deployment.apps/webshop scaled
deployment.apps/product-management scaled
   Scaling down databases...
deployment.apps/webshop-db scaled
deployment.apps/pm-db scaled
   Waiting for pods to terminate...
   Deleting PVCs...
persistentvolumeclaim "webshop-db-pvc" deleted from webshop namespace
persistentvolumeclaim "pm-db-pvc" deleted from product-management namespace
   Deleting local database data...
   Re-applying PV/PVC definitions...
persistentvolume/webshop-db-pv unchanged
persistentvolumeclaim/webshop-db-pvc created
persistentvolume/pm-db-pv unchanged
persistentvolumeclaim/pm-db-pvc created
persistentvolume/warehouse-db-pv unchanged
persistentvolumeclaim/warehouse-db-pvc unchanged
persistentvolume/order-db-pv unchanged
persistentvolumeclaim/order-db-pvc unchanged
   Scaling databases back up...
deployment.apps/webshop-db scaled
deployment.apps/pm-db scaled
   Waiting for databases to be ready...
error: timed out waiting for the condition on pods/webshop-db-74885b88df-n8lg8
error: timed out waiting for the condition on pods/pm-db-bd78669d4-t42nk
   Waiting 15s for Postgres initialization...
   Scaling applications back up...
deployment.apps/webshop scaled
deployment.apps/product-management scaled

--- Fix v2 Complete ---
Please wait a few moments for the applications to start, then run ./debug-endpoints.sh to verify.
