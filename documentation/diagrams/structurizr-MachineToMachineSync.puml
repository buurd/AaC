@startuml
title <size:24>Dynamic View: Product Management System - PM WebServer</size>\n<size:24>M2M Sync Flow</size>

set separator none
top to bottom direction
hide stereotype

<style>
  root {
    BackgroundColor: #ffffff;
    FontColor: #444444;
  }
  // Element,Component,Service
  .Element-RWxlbWVudCxDb21wb25lbnQsU2VydmljZQ== {
    BackgroundColor: #666666;
    LineColor: #474747;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Container,Database
  .Element-RWxlbWVudCxDb250YWluZXIsRGF0YWJhc2U= {
    BackgroundColor: #999999;
    LineColor: #6b6b6b;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Container,Infrastructure,Security
  .Element-RWxlbWVudCxDb250YWluZXIsSW5mcmFzdHJ1Y3R1cmUsU2VjdXJpdHk= {
    BackgroundColor: #333333;
    LineColor: #232323;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Container,Web Server
  .Element-RWxlbWVudCxDb250YWluZXIsV2ViIFNlcnZlcg== {
    BackgroundColor: #438dd5;
    LineColor: #2e6295;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Relationship
  .Relationship-UmVsYXRpb25zaGlw {
    LineThickness: 2;
    LineStyle: 10-10;
    LineColor: #444444;
    FontColor: #444444;
    FontSize: 24;
  }
  // PM WebServer
  .Boundary-UE0gV2ViU2VydmVy {
    BackgroundColor: #ffffff;
    LineColor: #2e6295;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
  }
  // Product Management System
  .Boundary-UHJvZHVjdCBNYW5hZ2VtZW50IFN5c3RlbQ== {
    BackgroundColor: #ffffff;
    LineColor: #0b4884;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
  }
</style>

rectangle "Product Management System\n<size:16>[Software System]</size>" <<Boundary-UHJvZHVjdCBNYW5hZ2VtZW50IFN5c3RlbQ==>> {
  rectangle "PM WebServer\n<size:16>[Container]</size>" <<Boundary-UE0gV2ViU2VydmVy>> {
    rectangle "==ProductService\n<size:16>[Component]</size>\n\nHandles business logic and sync." <<Element-RWxlbWVudCxDb21wb25lbnQsU2VydmljZQ==>> as ProductManagementSystem.PMWebServer.ProductService
  }

}

hexagon "==Keycloak Server\n<size:16>[Container]</size>\n\nHandles AuthN/AuthZ." <<Element-RWxlbWVudCxDb250YWluZXIsSW5mcmFzdHJ1Y3R1cmUsU2VjdXJpdHk=>> as KeycloakIAM.KeycloakServer
rectangle "==Webshop WebServer\n<size:16>[Container]</size>\n\nThe web server." <<Element-RWxlbWVudCxDb250YWluZXIsV2ViIFNlcnZlcg==>> as Webshop.WebshopWebServer
database "==Webshop Database\n<size:16>[Container]</size>\n\nThe database." <<Element-RWxlbWVudCxDb250YWluZXIsRGF0YWJhc2U=>> as Webshop.WebshopDatabase

ProductManagementSystem.PMWebServer.ProductService --> KeycloakIAM.KeycloakServer <<Relationship-UmVsYXRpb25zaGlw>> : "1: 1. Requests token (Client Credentials)"
ProductManagementSystem.PMWebServer.ProductService --> Webshop.WebshopWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "2: 2. Sends sync request with token"
Webshop.WebshopWebServer --> KeycloakIAM.KeycloakServer <<Relationship-UmVsYXRpb25zaGlw>> : "3: 3. Verifies token"
Webshop.WebshopWebServer --> Webshop.WebshopDatabase <<Relationship-UmVsYXRpb25zaGlw>> : "4: 4. Updates database"

@enduml