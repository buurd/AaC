@startuml
title <size:24>Container View: Keycloak IAM</size>\n<size:24>Security Architecture</size>

set separator none
top to bottom direction
skinparam ranksep 60
skinparam nodesep 30
hide stereotype

<style>
  root {
    BackgroundColor: #ffffff;
    FontColor: #444444;
  }
  // Element,Container,Infrastructure,Security
  .Element-RWxlbWVudCxDb250YWluZXIsSW5mcmFzdHJ1Y3R1cmUsU2VjdXJpdHk= {
    BackgroundColor: #333333;
    LineColor: #232323;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Container,Web Server
  .Element-RWxlbWVudCxDb250YWluZXIsV2ViIFNlcnZlcg== {
    BackgroundColor: #438dd5;
    LineColor: #2e6295;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Person
  .Element-RWxlbWVudCxQZXJzb24= {
    BackgroundColor: #08427b;
    LineColor: #052e56;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Relationship
  .Relationship-UmVsYXRpb25zaGlw {
    LineThickness: 2;
    LineStyle: 10-10;
    LineColor: #444444;
    FontColor: #444444;
    FontSize: 24;
  }
  // Keycloak IAM
  .Boundary-S2V5Y2xvYWsgSUFN {
    BackgroundColor: #ffffff;
    LineColor: #232323;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
  }
  // Order Service
  .Boundary-T3JkZXIgU2VydmljZQ== {
    BackgroundColor: #ffffff;
    LineColor: #0b4884;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
  }
  // Product Management System
  .Boundary-UHJvZHVjdCBNYW5hZ2VtZW50IFN5c3RlbQ== {
    BackgroundColor: #ffffff;
    LineColor: #0b4884;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
  }
  // Warehouse Service
  .Boundary-V2FyZWhvdXNlIFNlcnZpY2U= {
    BackgroundColor: #ffffff;
    LineColor: #0b4884;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
  }
  // Webshop
  .Boundary-V2Vic2hvcA== {
    BackgroundColor: #ffffff;
    LineColor: #0b4884;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
  }
</style>

person "==Customer\n<size:16>[Person]</size>\n\nA customer of the webshop." <<Element-RWxlbWVudCxQZXJzb24=>> as Customer
person "==Product Manager\n<size:16>[Person]</size>\n\nA manager of products" <<Element-RWxlbWVudCxQZXJzb24=>> as ProductManager
person "==Warehouse Staff\n<size:16>[Person]</size>\n\nStaff managing inventory." <<Element-RWxlbWVudCxQZXJzb24=>> as WarehouseStaff
person "==Order Manager\n<size:16>[Person]</size>\n\nA manager of orders." <<Element-RWxlbWVudCxQZXJzb24=>> as OrderManager
person "==Developer\n<size:16>[Person]</size>\n\nA software developer." <<Element-RWxlbWVudCxQZXJzb24=>> as Developer

rectangle "Webshop\n<size:16>[Software System]</size>" <<Boundary-V2Vic2hvcA==>> {
  rectangle "==Webshop WebServer\n<size:16>[Container]</size>\n\nThe web server." <<Element-RWxlbWVudCxDb250YWluZXIsV2ViIFNlcnZlcg==>> as Webshop.WebshopWebServer
}

rectangle "Product Management System\n<size:16>[Software System]</size>" <<Boundary-UHJvZHVjdCBNYW5hZ2VtZW50IFN5c3RlbQ==>> {
  rectangle "==PM WebServer\n<size:16>[Container]</size>\n\nThe web server." <<Element-RWxlbWVudCxDb250YWluZXIsV2ViIFNlcnZlcg==>> as ProductManagementSystem.PMWebServer
}

rectangle "Warehouse Service\n<size:16>[Software System]</size>" <<Boundary-V2FyZWhvdXNlIFNlcnZpY2U=>> {
  rectangle "==Warehouse WebServer\n<size:16>[Container]</size>\n\nThe web server." <<Element-RWxlbWVudCxDb250YWluZXIsV2ViIFNlcnZlcg==>> as WarehouseService.WarehouseWebServer
}

rectangle "Order Service\n<size:16>[Software System]</size>" <<Boundary-T3JkZXIgU2VydmljZQ==>> {
  rectangle "==Order WebServer\n<size:16>[Container]</size>\n\nThe web server." <<Element-RWxlbWVudCxDb250YWluZXIsV2ViIFNlcnZlcg==>> as OrderService.OrderWebServer
}

rectangle "Keycloak IAM\n<size:16>[Software System]</size>" <<Boundary-S2V5Y2xvYWsgSUFN>> {
  hexagon "==Keycloak Server\n<size:16>[Container]</size>\n\nHandles AuthN/AuthZ." <<Element-RWxlbWVudCxDb250YWluZXIsSW5mcmFzdHJ1Y3R1cmUsU2VjdXJpdHk=>> as KeycloakIAM.KeycloakServer
}

Customer --> KeycloakIAM.KeycloakServer <<Relationship-UmVsYXRpb25zaGlw>> : "Authenticates with"
ProductManager --> KeycloakIAM.KeycloakServer <<Relationship-UmVsYXRpb25zaGlw>> : "Authenticates with"
WarehouseStaff --> KeycloakIAM.KeycloakServer <<Relationship-UmVsYXRpb25zaGlw>> : "Authenticates with"
OrderManager --> KeycloakIAM.KeycloakServer <<Relationship-UmVsYXRpb25zaGlw>> : "Authenticates with"
Webshop.WebshopWebServer --> KeycloakIAM.KeycloakServer <<Relationship-UmVsYXRpb25zaGlw>> : "Verifies tokens with"
ProductManagementSystem.PMWebServer --> KeycloakIAM.KeycloakServer <<Relationship-UmVsYXRpb25zaGlw>> : "Verifies tokens with"
WarehouseService.WarehouseWebServer --> KeycloakIAM.KeycloakServer <<Relationship-UmVsYXRpb25zaGlw>> : "Verifies tokens with"
OrderService.OrderWebServer --> KeycloakIAM.KeycloakServer <<Relationship-UmVsYXRpb25zaGlw>> : "Verifies tokens with"
ProductManagementSystem.PMWebServer --> Webshop.WebshopWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "Sends product updates to (HTTP)"
ProductManagementSystem.PMWebServer --> WarehouseService.WarehouseWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "Sends product updates to (HTTP)"
WarehouseService.WarehouseWebServer --> Webshop.WebshopWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "Sends stock updates to (HTTP)"
OrderService.OrderWebServer --> WarehouseService.WarehouseWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "Reserves stock in (HTTP)"
Webshop.WebshopWebServer --> OrderService.OrderWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "Fetches customer orders from (HTTP)"
OrderService.OrderWebServer --> WarehouseService.WarehouseWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "Notifies of confirmed order (HTTP)"
ProductManager --> ProductManagementSystem.PMWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "Interacts with"
ProductManagementSystem.PMWebServer --> ProductManager <<Relationship-UmVsYXRpb25zaGlw>> : "Returns response to"
ProductManagementSystem.PMWebServer --> KeycloakIAM.KeycloakServer <<Relationship-UmVsYXRpb25zaGlw>> : "Validates token with"
KeycloakIAM.KeycloakServer --> ProductManagementSystem.PMWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "Returns token to"
Webshop.WebshopWebServer --> ProductManagementSystem.PMWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "Returns response to"
WarehouseStaff --> WarehouseService.WarehouseWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "Interacts with"
WarehouseStaff --> WarehouseService.WarehouseWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "Manages fulfillment"
OrderManager --> OrderService.OrderWebServer <<Relationship-UmVsYXRpb25zaGlw>> : "marks invoice as paid"

@enduml